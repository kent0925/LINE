<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç®¡ç†å¾Œå° - æ´»å‹•ç™¼ä½ˆèˆ‡ç®¡ç†</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<style>
/* æ¨£å¼å»¶ç”¨ä¸»é¡Œé¢¨æ ¼ */
:root {
  --line-green: #06C755;
  --accent-red: #FF3B30;
}
body { font-family: sans-serif; background: #f4f7f6; padding: 15px; }
.container { max-width: 500px; margin: auto; background: white; padding: 25px; border-radius: 24px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
h1 { color: var(--line-green); text-align: center; }
.form-group { margin-bottom: 15px; }
label { display: block; margin-bottom: 5px; font-weight: bold; color: #4a5568; font-size: 0.9rem; }
input { width: 100%; padding: 12px; border: 1.5px solid #e2e8f0; border-radius: 12px; box-sizing: border-box; }
.btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 1rem; }
.btn-submit { background: var(--line-green); color: white; }
.event-item { border-bottom: 1px solid #eee; padding: 15px 0; display: flex; justify-content: space-between; align-items: center; }
.del-btn { color: var(--accent-red); cursor: pointer; font-weight: bold; font-size: 0.9rem; padding: 5px 10px; border: 1px solid var(--accent-red); border-radius: 8px; }
</style>
</head>
<body>

<div class="container">
  <h1>ğŸ› ï¸ å»ºç«‹æ–°æ´»å‹•</h1>
  <div class="form-group"><label>æ´»å‹•æ¨™é¡Œ</label><input type="text" id="title" placeholder="ä¾‹å¦‚ï¼šæ˜¥å­£äº¤æµæœƒ"></div>
  <div class="form-group"><label>æ´»å‹•æ™‚é–“</label><input type="datetime-local" id="time"></div>
  <div class="form-group"><label>é–‹æ”¾å ±åæ™‚é–“</label><input type="datetime-local" id="openTime"></div>
  <div class="form-group"><label>æˆªæ­¢å ±åæ™‚é–“</label><input type="datetime-local" id="closeTime"></div>
  <div class="form-group"><label>å ´åœ°åç¨±</label><input type="text" id="venue" placeholder="ä¾‹å¦‚ï¼šå°åŒ—è¾¦å…¬å®¤"></div>
  <div class="form-group"><label>å®Œæ•´åœ°å€</label><input type="text" id="address" placeholder="è‡ªå‹•ç”Ÿæˆåœ°åœ–é€£çµ"></div>
  <button class="btn btn-submit" onclick="publishEvent()">ç™¼ä½ˆä¸¦å…¬é–‹</button>

  <hr style="margin: 30px 0; border: 0; border-top: 2px dashed #eee;">

  <h2>ğŸ“‹ æˆ‘å»ºç«‹çš„æ´»å‹•ç®¡ç†</h2>
  <div id="my-events-list">è®€å–ä¸­...</div>
</div>

<script>
const GAS_URL='ä½ çš„_GAS_éƒ¨ç½²ç¶²å€';
const LIFF_ID='ä½ çš„_ç®¡ç†ç«¯_LIFF_ID';
let ADMIN_UID='', ADMIN_NICKNAME='';

async function init(){
  await liff.init({ liffId: LIFF_ID });
  if(!liff.isLoggedIn()){ liff.login(); return; }
  const profile = await liff.getProfile();
  ADMIN_UID = profile.userId;
  ADMIN_NICKNAME = profile.displayName;
  loadMyEvents();
}

async function publishEvent(){
  const payload = {
    action: 'createEvent',
    adminUid: ADMIN_UID,
    adminNickname: ADMIN_NICKNAME,
    title: document.getElementById('title').value,
    time: document.getElementById('time').value,
    openTime: document.getElementById('openTime').value,
    closeTime: document.getElementById('closeTime').value,
    venueName: document.getElementById('venue').value,
    address: document.getElementById('address').value
  };

  if(!payload.title || !payload.time) return alert('è«‹å¡«å¯«å®Œæ•´è³‡è¨Š');

  const res = await fetch(GAS_URL, { method: 'POST', body: JSON.stringify(payload) });
  const data = await res.json();
  if(data.status === 'success'){
    alert('ç™¼ä½ˆæˆåŠŸï¼');
    location.reload();
  }
}

async function loadMyEvents(){
  const res = await fetch(`${GAS_URL}?action=getMyEvents&adminUid=${ADMIN_UID}`);
  const data = await res.json();
  const list = document.getElementById('my-events-list');
  list.innerHTML = '';
  
  if(data.events.length === 0) list.innerHTML = '<p style="color:#999; text-align:center;">ç›®å‰æ²’æœ‰å»ºç«‹ä»»ä½•æ´»å‹•</p>';

  data.events.forEach(ev => {
    list.innerHTML += `
      <div class="event-item">
        <div>
          <div style="font-weight:bold;">${ev.Title}</div>
          <div style="font-size:0.8rem; color:#666;">ğŸ“… ${ev.Time.replace('T', ' ')}</div>
        </div>
        <div class="del-btn" onclick="deleteEvent('${ev.EventID}')">ğŸ—‘ï¸ åˆªé™¤</div>
      </div>
    `;
  });
}

async function deleteEvent(id){
  if(!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤æ´»å‹•å—ï¼Ÿé€™å°‡æœƒä¸€ä½µç§»é™¤æ‰€æœ‰ç›¸é—œçš„å ±åè³‡æ–™ï¼')) return;
  const res = await fetch(GAS_URL, {
    method: 'POST',
    body: JSON.stringify({ action: 'deleteEvent', eventId: id, adminUid: ADMIN_UID })
  });
  const data = await res.json();
  if(data.status === 'success') loadMyEvents();
}

init();
</script>
</body>
</html>
